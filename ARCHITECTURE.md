# Whalli Monorepo Architecture

## ğŸ—ï¸ High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Whalli Monorepo                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                         Apps                            â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚                                                         â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚   Backend    â”‚  â”‚     Web      â”‚  â”‚    Admin     â”‚ â”‚  â”‚
â”‚  â”‚  â”‚   (NestJS)   â”‚  â”‚  (Next.js)   â”‚  â”‚  (Next.js)   â”‚ â”‚  â”‚
â”‚  â”‚  â”‚   Port 4000  â”‚  â”‚  Port 3000   â”‚  â”‚  Port 3001   â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚         â”‚                 â”‚                  â”‚         â”‚  â”‚
â”‚  â”‚         â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚  â”‚
â”‚  â”‚         â”‚                          â”‚                   â”‚  â”‚
â”‚  â”‚         â”‚                  Uses @whalli/ui            â”‚  â”‚
â”‚  â”‚         â”‚                  Uses @whalli/utils         â”‚  â”‚
â”‚  â”‚         â”‚                                              â”‚  â”‚
â”‚  â”‚         â”‚  ONLY consumer of @whalli/prisma            â”‚  â”‚
â”‚  â”‚         â”‚                                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚            â”‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                       Packages                         â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚                                                        â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  @whalli/prismaâ”‚  â”‚@whalli/utilsâ”‚ â”‚@whalli/ui  â”‚  â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Prisma Schemaâ”‚  â”‚ â€¢ Utilitiesâ”‚  â”‚ â€¢ Button   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Client Gen   â”‚  â”‚ â€¢ Zod      â”‚  â”‚ â€¢ Card     â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Migrations   â”‚  â”‚ â€¢ Helpers  â”‚  â”‚ â€¢ Input    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                â”‚  â”‚ â€¢ Types    â”‚  â”‚ â€¢ Tailwind â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚          â”‚                                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚             â”‚                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    Database                         â”‚    â”‚
â”‚  â”‚                  (PostgreSQL)                       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š Data Flow

### API Request Flow
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Browser â”‚â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  Next.js â”‚â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  NestJS  â”‚
â”‚         â”‚  HTTP  â”‚ Web/Adminâ”‚  HTTP  â”‚  Backend â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                                             â”‚
                                             â”‚ Prisma
                                             â”‚ Client
                                             â–¼
                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                      â”‚PostgreSQLâ”‚
                                      â”‚ Database â”‚
                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Component Sharing
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    @whalli/ui                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  Button  â”‚  â”‚   Card   â”‚  â”‚  Input   â”‚  ...       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚            â”‚
         â–¼            â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Web   â”‚   â”‚ Admin  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ” Isolation Principles

### Prisma Client Access
```
âœ… ALLOWED:
Backend (apps/backend) â”€â”€â”€â”€â”€â”€â–¶ @whalli/prisma

âŒ FORBIDDEN:
Web (apps/web) â”€â”€â”€â”€â”€â”€âœ—â”€â”€â”€â”€â”€â”€â–¶ @whalli/prisma
Admin (apps/admin) â”€â”€âœ—â”€â”€â”€â”€â”€â”€â–¶ @whalli/prisma
```

### Frontend-Backend Communication
```
Web/Admin â”€â”€â”€â”€â”€(HTTP API)â”€â”€â”€â”€â–¶ Backend â”€â”€â”€â”€â”€(Prisma)â”€â”€â”€â”€â–¶ Database
           Never direct access to database
```

## ğŸ“¦ Package Dependencies

```
apps/backend
â”œâ”€â”€ @whalli/prisma     âœ… Only app that imports this
â”œâ”€â”€ @whalli/utils      âœ…
â”œâ”€â”€ @nestjs/core
â”œâ”€â”€ @nestjs/common
â””â”€â”€ ... (other NestJS deps)

apps/web
â”œâ”€â”€ @whalli/ui         âœ…
â”œâ”€â”€ @whalli/utils      âœ…
â”œâ”€â”€ next
â”œâ”€â”€ react
â””â”€â”€ ... (other Next.js deps)

apps/admin
â”œâ”€â”€ @whalli/ui         âœ…
â”œâ”€â”€ @whalli/utils      âœ…
â”œâ”€â”€ next
â”œâ”€â”€ react
â””â”€â”€ ... (other Next.js deps)

packages/ui
â”œâ”€â”€ @whalli/utils      âœ…
â”œâ”€â”€ react
â”œâ”€â”€ lucide-react
â””â”€â”€ tailwindcss

packages/utils
â”œâ”€â”€ zod
â”œâ”€â”€ clsx
â””â”€â”€ tailwind-merge

packages/prisma
â”œâ”€â”€ @prisma/client
â””â”€â”€ prisma (dev)
```

## ğŸ”„ Build Order (via Turborepo)

```
1. packages/prisma (generate Prisma Client)
   â”‚
   â”œâ”€â–¶ 2. packages/utils
   â”‚      â”‚
   â”‚      â””â”€â–¶ 3. packages/ui
   â”‚             â”‚
   â”‚             â”œâ”€â–¶ 4. apps/web
   â”‚             â”œâ”€â–¶ 5. apps/admin
   â”‚             â””â”€â–¶ 6. apps/backend
   â”‚
   â””â”€â–¶ 6. apps/backend (depends on prisma)
```

## ğŸ¯ Development Workflow

### Feature Development
```
1. Create feature branch
   â”‚
2. Develop in relevant app/package
   â”‚
3. Share components via packages/ui
   â”‚
4. Share utilities via packages/utils
   â”‚
5. Backend manages all database access
   â”‚
6. Frontend calls backend APIs
   â”‚
7. Test, lint, type-check
   â”‚
8. Commit and PR
```

## ğŸš€ Deployment Strategy

### Independent Deployments
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Production               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                          â”‚
â”‚  Backend                                 â”‚
â”‚  (Railway/Heroku)                        â”‚
â”‚  â””â”€â–¶ Connected to PostgreSQL            â”‚
â”‚                                          â”‚
â”‚  Web                                     â”‚
â”‚  (Vercel)                                â”‚
â”‚  â””â”€â–¶ Calls Backend API                  â”‚
â”‚                                          â”‚
â”‚  Admin                                   â”‚
â”‚  (Vercel)                                â”‚
â”‚  â””â”€â–¶ Calls Backend API                  â”‚
â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ TypeScript Configuration

```
Root tsconfig.json (base config)
      â”‚
      â”œâ”€â–¶ packages/prisma/tsconfig.json
      â”œâ”€â–¶ packages/utils/tsconfig.json
      â”œâ”€â–¶ packages/ui/tsconfig.json
      â”œâ”€â–¶ apps/backend/tsconfig.json
      â”œâ”€â–¶ apps/web/tsconfig.json
      â””â”€â–¶ apps/admin/tsconfig.json
```

## ğŸ”§ Tooling Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Development Tools              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  Turborepo         Orchestration        â”‚
â”‚  pnpm              Package Management   â”‚
â”‚  TypeScript        Type Safety          â”‚
â”‚  ESLint            Code Quality         â”‚
â”‚  Prettier          Code Formatting      â”‚
â”‚  Tailwind CSS      Styling              â”‚
â”‚  Prisma            Database ORM         â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¨ UI Component Library

```
@whalli/ui
â”œâ”€â”€ Button
â”‚   â”œâ”€â”€ variants: default, outline, ghost, destructive
â”‚   â””â”€â”€ sizes: default, sm, lg, icon
â”‚
â”œâ”€â”€ Card
â”‚   â”œâ”€â”€ Card
â”‚   â”œâ”€â”€ CardHeader
â”‚   â”œâ”€â”€ CardTitle
â”‚   â”œâ”€â”€ CardDescription
â”‚   â”œâ”€â”€ CardContent
â”‚   â””â”€â”€ CardFooter
â”‚
â””â”€â”€ Input
    â””â”€â”€ Standard input with validation styles
```

## ğŸ—„ï¸ Database Schema

```
User (example model)
â”œâ”€â”€ id          String    @id @default(cuid())
â”œâ”€â”€ email       String    @unique
â”œâ”€â”€ name        String?
â”œâ”€â”€ createdAt   DateTime  @default(now())
â””â”€â”€ updatedAt   DateTime  @updatedAt

(Add more models as needed)
```

## ğŸŒ API Structure (Backend)

```
apps/backend/src/
â”œâ”€â”€ main.ts              Entry point
â”œâ”€â”€ app.module.ts        Root module
â”œâ”€â”€ prisma/
â”‚   â”œâ”€â”€ prisma.module.ts
â”‚   â””â”€â”€ prisma.service.ts
â””â”€â”€ users/               Feature module
    â”œâ”€â”€ users.module.ts
    â”œâ”€â”€ users.controller.ts
    â”œâ”€â”€ users.service.ts
    â””â”€â”€ dto/
        â””â”€â”€ create-user.dto.ts
```

---

This architecture ensures:
- âœ… Clear separation of concerns
- âœ… Type safety across the stack
- âœ… Reusable components and utilities
- âœ… Scalable monorepo structure
- âœ… Independent deployment of apps
