# Migration vers Dokploy - Guide rapide

## üéØ R√©sum√© de la restructuration

Votre codebase Whalli a √©t√© optimis√©e pour Dokploy avec :

### ‚úÖ Nouveaux fichiers cr√©√©s

1. **Configuration Dokploy**
   - `dokploy.config.yml` - Configuration principale
   - `.env.dokploy.example` - Template variables d'environnement
   - `deploy-dokploy.sh` - Script de d√©ploiement automatis√©

2. **Dockerfiles optimis√©s**
   - `apps/api/Dockerfile.dokploy` - API NestJS
   - `apps/web/Dockerfile.dokploy` - Application Web Next.js  
   - `apps/admin/Dockerfile.dokploy` - Panel Admin Next.js
   - `apps/api/Dockerfile.workers.dokploy` - Workers background

3. **Documentation**
   - `DOKPLOY_DEPLOYMENT.md` - Guide complet de d√©ploiement
   - `.dokployignore` - Fichiers √† ignorer lors du build

### ‚úÖ Modifications des fichiers existants

- `.gitignore` - Ajout de `.env.dokploy`
- `turbo.json` - Support des variables Dokploy

## üöÄ D√©ploiement en 3 √©tapes

### 1. Configuration

```bash
# Copier et √©diter l'environnement
cp .env.dokploy.example .env.dokploy
nano .env.dokploy

# G√©n√©rer des secrets s√©curis√©s
./deploy-dokploy.sh secrets
```

### 2. Pr√©requis externes

- **Base de donn√©es** : Cr√©er une instance PostgreSQL (Neon recommand√©)
- **Domaine** : Configurer les DNS vers votre VPS Dokploy
- **APIs** : Obtenir les cl√©s OpenAI, Anthropic, xAI, Stripe

### 3. D√©ploiement

```bash
# D√©ploiement complet automatis√©
./deploy-dokploy.sh full
```

## üìã Checklist de migration

### Pr√©paration VPS

- [ ] VPS avec Dokploy install√©
- [ ] Domaine configur√© (DNS A record vers VPS)
- [ ] Acc√®s SSH au VPS

### Configuration services

- [ ] Base de donn√©es PostgreSQL cr√©√©e (Neon/Railway/autre)
- [ ] Variables d'environnement configur√©es dans `.env.dokploy`
- [ ] Secrets g√©n√©r√©s (`./deploy-dokploy.sh secrets`)

### APIs externes

- [ ] OpenAI API Key obtenue
- [ ] Anthropic API Key obtenue  
- [ ] xAI API Key obtenue
- [ ] Stripe configur√© (cl√©s + webhooks)
- [ ] OAuth Apps cr√©√©es (GitHub, Google)

### D√©ploiement

- [ ] Configuration valid√©e (`./deploy-dokploy.sh check`)
- [ ] Migrations appliqu√©es (`./deploy-dokploy.sh migrate`)
- [ ] Services d√©ploy√©s (`./deploy-dokploy.sh deploy`)
- [ ] Health checks valid√©s (`./deploy-dokploy.sh health`)

## üîß Diff√©rences avec Docker Compose

| Aspect | Docker Compose | Dokploy |
|--------|----------------|---------|
| **Orchestration** | docker-compose.yml | dokploy.config.yml |
| **SSL** | Traefik manuel | Automatique Let's Encrypt |
| **Monitoring** | Prometheus/Grafana | Interface Dokploy int√©gr√©e |
| **Scaling** | `docker-compose scale` | `dokploy scale` |
| **Logs** | `docker logs` | Interface web + CLI |
| **Updates** | Rebuild manuel | Git push auto-deploy |

## üåê URLs des services

Apr√®s d√©ploiement sur `votre-domaine.com` :

- **Web App** : https://votre-domaine.com
- **API** : https://api.votre-domaine.com  
- **Admin** : https://admin.votre-domaine.com
- **Storage** : https://storage.votre-domaine.com
- **MinIO UI** : https://minio.votre-domaine.com

## üîÑ Workflow de d√©veloppement

### D√©veloppement local (inchang√©)

```bash
pnpm dev  # Continue √† fonctionner normalement
```

### D√©ploiement production

```bash
git push origin main
./deploy-dokploy.sh deploy
```

## üìû Support

En cas de probl√®me :

1. **V√©rifier les logs** : `./deploy-dokploy.sh logs [service]`
2. **Rollback** : `./deploy-dokploy.sh rollback`
3. **Documentation** : Consulter `DOKPLOY_DEPLOYMENT.md`

## üéâ Avantages Dokploy

- ‚úÖ **Interface graphique** pour g√©rer les d√©ploiements
- ‚úÖ **SSL automatique** avec Let's Encrypt
- ‚úÖ **Monitoring int√©gr√©** et m√©triques
- ‚úÖ **Auto-scaling** et gestion des ressources
- ‚úÖ **Rollbacks** automatiques en cas d'√©chec
- ‚úÖ **Git integration** pour d√©ploiements automatiques
- ‚úÖ **Multi-environnements** (staging/production)

Votre migration est pr√™te ! üöÄ