# Chat Home Page - Documentation

## Vue d'ensemble

La page d'accueil du chat (`/chat`) offre une interface √©l√©gante et intuitive pour d√©marrer de nouvelles conversations avec l'IA, inspir√©e par ChatGPT et Grok.

## Caract√©ristiques principales

### 1. Design centr√© et minimaliste

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                                        ‚îÇ
‚îÇ              [Logo W]                  ‚îÇ
‚îÇ                                        ‚îÇ
‚îÇ     Comment puis-je vous aider ?      ‚îÇ
‚îÇ   Posez-moi une question ou...       ‚îÇ
‚îÇ                                        ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê          ‚îÇ
‚îÇ  ‚îÇ üí°       ‚îÇ  ‚îÇ ‚úçÔ∏è       ‚îÇ          ‚îÇ
‚îÇ  ‚îÇ Concept  ‚îÇ  ‚îÇ Contenu  ‚îÇ          ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îÇ
‚îÇ                                        ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ GPT-4o ‚ñº                       ‚îÇ  ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§  ‚îÇ
‚îÇ  ‚îÇ [üìé]  √âcrivez votre message... ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                            [‚Üí] ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 2. Logo et titre

- Logo "W" avec d√©grad√© bleu-violet
- Titre d'accueil personnalis√© : "Comment puis-je vous aider ?"
- Sous-titre invitant √† l'interaction

### 3. Cartes de suggestions

4 cartes cliquables avec suggestions de prompts :

| Ic√¥ne | Titre | Prompt sugg√©r√© |
|-------|-------|----------------|
| üí° | Expliquer un concept | "Explique-moi la relativit√© g√©n√©rale..." |
| ‚úçÔ∏è | R√©diger du contenu | "Aide-moi √† √©crire un email professionnel" |
| üîç | Analyser des donn√©es | "Comment analyser ce fichier CSV ?" |
| üé® | G√©n√©rer des id√©es | "Donne-moi des id√©es cr√©atives..." |

**Comportement** : Cliquer sur une carte pr√©-remplit le champ de message.

### 4. S√©lecteur de mod√®le

Dropdown permettant de choisir le mod√®le d'IA :

- **GPT-4o** - Most capable model
- **GPT-4 Turbo** - Fast and powerful  
- **GPT-3.5 Turbo** - Quick responses

**Emplacement** : En haut de la zone d'input, avec ic√¥ne ‚ú® (Sparkles)

### 5. Gestion des pi√®ces jointes

#### Types de fichiers support√©s
- **Images** : `image/*` (JPEG, PNG, GIF, etc.)
- **Documents** : `.pdf`, `.doc`, `.docx`, `.txt`

#### Interface
- **Bouton d'ajout** : Ic√¥ne trombone (üìé) √† gauche de l'input
- **Preview des images** : Miniature 80x80px avec bouton de suppression
- **Preview des documents** : Badge avec nom de fichier tronqu√©

#### Fonctionnalit√©s
- Multi-upload (plusieurs fichiers √† la fois)
- Suppression individuelle (bouton ‚ùå sur chaque pi√®ce jointe)
- Preview automatique pour les images (Base64)

### 6. Zone de saisie

#### Caract√©ristiques
- **Textarea auto-expandable** : S'agrandit avec le contenu
- **Hauteur max** : 200px avec scroll
- **Placeholder** : "√âcrivez votre message... (Shift+Enter pour nouvelle ligne)"
- **Raccourcis** :
  - `Enter` : Envoyer le message
  - `Shift + Enter` : Nouvelle ligne

#### Bouton d'envoi
- **√âtat actif** : Bleu avec ombre quand message ou pi√®ces jointes pr√©sents
- **√âtat d√©sactiv√©** : Gris quand input vide
- **Ic√¥ne** : Fl√®che d'envoi (‚Üí)

### 7. Footer informatif

Disclaimer en bas de page :
> "Whalli peut faire des erreurs. V√©rifiez les informations importantes."

## Flux utilisateur

### D√©marrer une nouvelle conversation

1. **Utilisateur arrive sur `/chat`**
   - Voit la page d'accueil avec logo et suggestions
   - La sidebar contextuelle affiche l'historique des conversations

2. **Utilisateur √©crit un message**
   - Peut cliquer sur une suggestion ou √©crire librement
   - Peut ajouter des pi√®ces jointes (images, documents)
   - Peut changer le mod√®le d'IA

3. **Utilisateur envoie le message**
   - Un nouveau chat est cr√©√© avec le titre = d√©but du message
   - Le message est envoy√©
   - **Redirection automatique** vers `/chat/[id]`

### Cas d'usage

#### Envoi simple
```typescript
message = "Explique-moi la blockchain"
model = "gpt-4o"
‚Üí Cr√©e chat + envoie message + redirige
```

#### Envoi avec pi√®ces jointes
```typescript
message = "Analyse cette image"
attachments = [image.png]
model = "gpt-4o"
‚Üí Cr√©e chat + envoie message avec attachements + redirige
```

## Architecture technique

### √âtat local

```typescript
interface State {
  message: string;                    // Contenu du message
  selectedModel: Model;               // Mod√®le s√©lectionn√©
  showModelSelect: boolean;           // Visibilit√© du dropdown
  attachments: Attachment[];          // Fichiers attach√©s
  sending: boolean;                   // √âtat d'envoi
}

interface Attachment {
  id: string;                         // ID unique g√©n√©r√©
  file: File;                         // Objet File natif
  type: 'image' | 'document';         // Type d√©termin√© par MIME
  preview?: string;                   // Base64 pour images
}

interface Model {
  id: string;                         // 'gpt-4o', 'gpt-4-turbo', etc.
  name: string;                       // Nom affich√©
  description: string;                // Description courte
}
```

### Hooks utilis√©s

```typescript
// Navigation
const router = useRouter();

// Sidebar contextuelle
usePageWidgets([
  {
    id: 'chat-history',
    title: 'Conversations',
    content: <ChatHistoryList />,
  },
]);

// R√©f√©rence au input file cach√©
const fileInputRef = useRef<HTMLInputElement>(null);
```

### Fonctions principales

#### `handleFileSelect()`
- Lit les fichiers s√©lectionn√©s
- Cr√©e les objets Attachment
- G√©n√®re les previews pour les images (FileReader)
- Ajoute √† l'√©tat `attachments`

#### `removeAttachment(id)`
- Filtre l'attachment par ID
- Met √† jour l'√©tat

#### `handleSend()`
1. Cr√©e un nouveau chat via `api.createChat()`
2. Envoie le premier message via `api.sendMessage()`
3. Navigue vers `/chat/[id]`

#### `handleKeyDown()`
- D√©tecte `Enter` (sans Shift) pour envoyer
- Permet `Shift+Enter` pour nouvelle ligne

## Styling

### Couleurs et th√®me

```css
/* Logo */
bg-gradient-to-br from-blue-500 to-purple-600
shadow-lg shadow-blue-500/20

/* Cartes de suggestion */
bg-zinc-900/50 hover:bg-zinc-800/50
border-zinc-800 hover:border-zinc-700

/* Input container */
bg-zinc-900 border-zinc-800
rounded-2xl shadow-2xl

/* Bouton d'envoi (actif) */
bg-blue-600 hover:bg-blue-700
shadow-lg shadow-blue-600/20

/* Dropdown mod√®le */
bg-zinc-800 border-zinc-700
hover:bg-zinc-700
```

### Responsive

- **Max-width** : 768px (3xl)
- **Padding** : Adaptatif selon la taille d'√©cran
- **Grid suggestions** : 2 colonnes (peut √™tre 1 en mobile)

### Animations

- **Transitions** : `transition-all` sur les cartes et boutons
- **Hover effects** : Changement de couleur sur hover
- **Textarea auto-resize** : Smooth height adjustment

## Int√©gration avec l'API

### Cr√©ation du chat

```typescript
POST /api/chats
Body: {
  title: string,    // Premiers 50 caract√®res du message
  model: string,    // ID du mod√®le s√©lectionn√©
}
Response: Chat
```

### Envoi du message

```typescript
POST /api/chats/:id/messages
Body: {
  content: string,  // Contenu du message
}
Response: {
  userMessage: Message,
  assistantMessage: Message,
}
```

**Note** : Les pi√®ces jointes ne sont pas encore impl√©ment√©es c√¥t√© backend. Pour l'instant, seul le texte est envoy√©.

## TODO / Am√©liorations futures

### Court terme
- [ ] Impl√©menter l'upload r√©el des pi√®ces jointes
  - Modifier l'API pour accepter des multipart/form-data
  - Stocker les fichiers (S3, Cloudinary, etc.)
  - Passer les URLs au mod√®le d'IA
- [ ] Ajouter un indicateur de chargement pendant l'envoi
- [ ] G√©rer les erreurs avec des toasts/notifications

### Moyen terme
- [ ] Drag & drop pour les pi√®ces jointes
- [ ] Support des fichiers Excel, CSV
- [ ] Historique des prompts r√©cents
- [ ] Templates de prompts personnalis√©s
- [ ] Raccourcis clavier pour s√©lection rapide du mod√®le

### Long terme
- [ ] Support de la voix (speech-to-text)
- [ ] G√©n√©ration d'images (DALL-E, Midjourney)
- [ ] Partage de conversations
- [ ] Export en PDF/Markdown

## Cas limites et gestion d'erreurs

### Fichiers trop volumineux
**TODO** : Ajouter validation c√¥t√© client
```typescript
if (file.size > 10 * 1024 * 1024) { // 10MB
  alert('File too large');
  return;
}
```

### Types de fichiers non support√©s
**Actuel** : Le `accept` de l'input file limite d√©j√†
**√Ä am√©liorer** : Validation explicite + message d'erreur

### √âchec de cr√©ation du chat
**Actuel** : `console.error()` + `sending` reste √† true
**√Ä am√©liorer** : Afficher erreur √† l'utilisateur + reset √©tat

### Message vide
**Prot√©g√©** : Le bouton d'envoi est d√©sactiv√© si message vide ET aucune pi√®ce jointe

## Accessibilit√©

- ‚úÖ Boutons avec `title` pour tooltips
- ‚úÖ `alt` sur les images
- ‚úÖ Labels implicites (`aria-label` sur boutons)
- ‚ö†Ô∏è **√Ä am√©liorer** : 
  - Focus management (keyboard navigation)
  - ARIA roles pour le dropdown
  - Screen reader announcements

## Performance

- ‚úÖ FileReader asynchrone pour les previews
- ‚úÖ Next.js Image pour optimisation automatique
- ‚úÖ Composants fonctionnels avec hooks
- ‚ö†Ô∏è **√Ä surveiller** :
  - Taille des previews Base64 en m√©moire
  - Re-renders inutiles (useCallback/useMemo si n√©cessaire)

## Tests sugg√©r√©s

### Tests manuels
1. √âcrire un message ‚Üí Envoyer ‚Üí V√©rifier redirection
2. Ajouter une image ‚Üí V√©rifier preview ‚Üí Supprimer ‚Üí V√©rifier disparition
3. Ajouter un PDF ‚Üí V√©rifier badge ‚Üí Envoyer
4. Changer de mod√®le ‚Üí V√©rifier persistance
5. Shift+Enter ‚Üí V√©rifier nouvelle ligne
6. Enter ‚Üí V√©rifier envoi

### Tests automatis√©s (√† impl√©menter)
```typescript
describe('ChatPage', () => {
  it('should show welcome screen', () => {});
  it('should enable send button when message is typed', () => {});
  it('should create chat and redirect on send', () => {});
  it('should allow file attachments', () => {});
  it('should change model selection', () => {});
});
```

---

**Fichier** : `apps/web/app/(app)/chat/page.tsx`  
**Lignes** : ~306  
**D√©pendances** : Next.js, React, Lucide Icons, API Client  
**Version** : 1.0  
**Date** : Octobre 2025
